import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;

public class DBOperation {

	//JDBC 驱动名及数据库 URL
    static final String JDBC_DRIVER = "com.mysql.jdbc.Driver";  
    static final String DB_URL = "jdbc:mysql://localhost:3306/librarymanage?useSSL=false";
    // 数据库的用户名与密码
    static final String USER = "root";
    static final String PASS = "root";
    
    public boolean register(String acc, String pwd) {
	    java.sql.Connection conn = null;
        java.sql.Statement stmt = null;
        try{
            // 注册 JDBC 驱动
            Class.forName(JDBC_DRIVER);
            // 打开链接
            conn = DriverManager.getConnection(DB_URL,USER,PASS);
            // 执行查询
            stmt = conn.createStatement();
            String sql;
            sql = "SELECT * from account";
            ResultSet rs = stmt.executeQuery(sql);
            // 展开结果集数据库
            while(rs.next()){
                // 通过字段检索
                String Acc = rs.getString("Acc");
                // 判断账号是否存在
                if(acc.equals(Acc))
                	return false;
            }
            sql = "INSERT INTO account VALUES ('" + acc + "','" + pwd +"')";
            stmt.executeUpdate(sql);
            // 完成后关闭
            rs.close();
            stmt.close();
            conn.close();
            return true;
        }catch(SQLException se){
            // 处理 JDBC 错误
            se.printStackTrace();
        }catch(Exception e){
            // 处理 Class.forName 错误
            e.printStackTrace();
        }finally{
            // 关闭资源
            try{
                if(stmt!=null) stmt.close();
            }catch(SQLException se2){
            }// 什么都不做
            try{
                if(conn!=null) conn.close();
            }catch(SQLException se){
                se.printStackTrace();
            }
        }
		return false;
    }
    
	public boolean isCorrect(String acc, String pwd) {
		    java.sql.Connection conn = null;
	        java.sql.Statement stmt = null;
	        try{
	            // 注册 JDBC 驱动
	            Class.forName(JDBC_DRIVER);
	            // 打开链接
	            conn = DriverManager.getConnection(DB_URL,USER,PASS);
	            // 执行查询
	            stmt = conn.createStatement();
	            String sql;
	            sql = "SELECT * from account";
	            ResultSet rs = stmt.executeQuery(sql);
	            // 展开结果集数据库
	            while(rs.next()){
	                // 通过字段检索
	                String Acc = rs.getString("Acc");
	                String Pwd = rs.getString("Pwd");
	                // 判断密码是否正确
	                if(acc.equals(Acc)&&pwd.equals(Pwd))
	                	return true;
	            }
	            // 完成后关闭
	            rs.close();
	            stmt.close();
	            conn.close();
	            return false;
	        }catch(SQLException se){
	            // 处理 JDBC 错误
	            se.printStackTrace();
	        }catch(Exception e){
	            // 处理 Class.forName 错误
	            e.printStackTrace();
	        }finally{
	            // 关闭资源
	            try{
	                if(stmt!=null) stmt.close();
	            }catch(SQLException se2){
	            }// 什么都不做
	            try{
	                if(conn!=null) conn.close();
	            }catch(SQLException se){
	                se.printStackTrace();
	            }
	        }
			return false;
	}
	
	public Object[][] getData() {
		java.sql.Connection conn = null;
        java.sql.Statement stmt = null;
        int count = 0;
        try{
            // 注册 JDBC 驱动
            Class.forName(JDBC_DRIVER);
            // 打开链接
            conn = DriverManager.getConnection(DB_URL,USER,PASS);
            // 执行查询
            stmt = conn.createStatement();
            String sql;
            sql = "SELECT * from book ORDER BY BookID";
            ResultSet rs = stmt.executeQuery(sql);
            // 展开结果集数据库
            while(rs.next())
                count++;
            Object[][] info = new Object[count][7];
            
            count = 0;
            rs = stmt.executeQuery(sql);
            while(rs.next()) {
            	info[count][0] = Integer.valueOf(rs.getInt("BookID"));
            	info[count][1] = rs.getString("BookISBN");
            	info[count][2] = rs.getString("BookName");
            	info[count][3] = rs.getString("BookAuthor");
            	info[count][4] = rs.getString("BookPress");
            	info[count][5] = Double.valueOf(rs.getDouble("BookPrice"));
            	info[count][6] = Integer.valueOf(rs.getInt("BookNumber"));
            	count++;
            }
            // 完成后关闭
            rs.close();
            stmt.close();
            conn.close();
            return info;
        }catch(SQLException se){
            // 处理 JDBC 错误
            se.printStackTrace();
        }catch(Exception e){
            // 处理 Class.forName 错误
            e.printStackTrace();
        }finally{
            // 关闭资源
            try{
                if(stmt!=null) stmt.close();
            }catch(SQLException se2){
            }// 什么都不做
            try{
                if(conn!=null) conn.close();
            }catch(SQLException se){
                se.printStackTrace();
            }
        }
		return null;
	}
	
	public boolean add(int id,String i,String j,String k,String l,double price,int number) {
		java.sql.Connection conn = null;
        java.sql.Statement stmt = null;
        try{
            // 注册 JDBC 驱动
            Class.forName(JDBC_DRIVER);
            // 打开链接
            conn = DriverManager.getConnection(DB_URL,USER,PASS);
            // 执行插入
            stmt = conn.createStatement();
            String sql;
            sql = "INSERT INTO book VALUES("+id+","+i+","+j+","+k+","+l+","+price+","+number+");";
            stmt.executeUpdate(sql);
            // 完成后关闭
            stmt.close();
            conn.close();
            return true;
        }catch(SQLException se){
            // 处理 JDBC 错误
            se.printStackTrace();
        }catch(Exception e){
            // 处理 Class.forName 错误
            e.printStackTrace();
        }finally{
            // 关闭资源
            try{
                if(stmt!=null) stmt.close();
            }catch(SQLException se2){
            }// 什么都不做
            try{
                if(conn!=null) conn.close();
            }catch(SQLException se){
                se.printStackTrace();
            }
        }
		return false;
	}
	public boolean del(String isbn) {
		java.sql.Connection conn = null;
        java.sql.Statement stmt = null;
        try{
            // 注册 JDBC 驱动
            Class.forName(JDBC_DRIVER);
            // 打开链接
            conn = DriverManager.getConnection(DB_URL,USER,PASS);
            // 执行插入
            stmt = conn.createStatement();
            String sql;
            sql = "SELECT BookISBN from book";
            ResultSet rs = stmt.executeQuery(sql);
            // 展开结果集数据库
            while(rs.next()){
                // 通过字段检索
                String ISBN = rs.getString("BookISBN");
                // 判断密码是否正确
                if(isbn.equals(ISBN)) {
                	sql = "DELETE FROM book where BookISBN='"+isbn+"'";
                    stmt.executeUpdate(sql);
                    stmt.close();
                    conn.close();
                	return true;
                }
            }
            // 完成后关闭
            stmt.close();
            conn.close();
            return false;
        }catch(SQLException se){
            // 处理 JDBC 错误
            se.printStackTrace();
        }catch(Exception e){
            // 处理 Class.forName 错误
            e.printStackTrace();
        }finally{
            // 关闭资源
            try{
                if(stmt!=null) stmt.close();
            }catch(SQLException se2){
            }// 什么都不做
            try{
                if(conn!=null) conn.close();
            }catch(SQLException se){
                se.printStackTrace();
            }
        }
		return false;
	}
	public static void main(String[] args) {
		DBOperation rip = new DBOperation();
		rip.del("999");
	}
}
